\doxysection{components/peripherals/i2c/esp\+\_\+sgp4x/sgp4x.c File Reference}
\hypertarget{sgp4x_8c}{}\label{sgp4x_8c}\index{components/peripherals/i2c/esp\_sgp4x/sgp4x.c@{components/peripherals/i2c/esp\_sgp4x/sgp4x.c}}
{\ttfamily \#include "{}include/sgp4x.\+h"{}}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$math.\+h$>$}\newline
{\ttfamily \#include $<$esp\+\_\+log.\+h$>$}\newline
{\ttfamily \#include $<$esp\+\_\+check.\+h$>$}\newline
{\ttfamily \#include $<$esp\+\_\+timer.\+h$>$}\newline
{\ttfamily \#include $<$freertos/\+Free\+RTOS.\+h$>$}\newline
{\ttfamily \#include $<$freertos/task.\+h$>$}\newline
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{sgp4x_8c_aeb90f1b78249ed18ba648a80ff425a7e}\label{sgp4x_8c_aeb90f1b78249ed18ba648a80ff425a7e} 
\#define {\bfseries SGP4\+X\+\_\+\+CRC8\+\_\+\+G\+\_\+\+POLYNOM}~UINT8\+\_\+C(0x31)
\begin{DoxyCompactList}\small\item\em sgp4x I2C CRC8 polynomial \end{DoxyCompactList}\item 
\Hypertarget{sgp4x_8c_a4e2ea64fd9fd0cd0d2e6c8203bea1c7a}\label{sgp4x_8c_a4e2ea64fd9fd0cd0d2e6c8203bea1c7a} 
\#define {\bfseries SGP4\+X\+\_\+\+CMD\+\_\+\+RESET}~UINT16\+\_\+C(0x0006)
\item 
\Hypertarget{sgp4x_8c_a6a0235a5480efbe0a7cb5a838277e5ec}\label{sgp4x_8c_a6a0235a5480efbe0a7cb5a838277e5ec} 
\#define {\bfseries SGP4\+X\+\_\+\+CMD\+\_\+\+RESET\+\_\+}~UINT8\+\_\+C(0x06)
\begin{DoxyCompactList}\small\item\em sgp4x I2C soft-\/reset command -\/ for some reason this is an 1-\/byte command \end{DoxyCompactList}\item 
\Hypertarget{sgp4x_8c_a18dc072f9640fb68a76cedd0b4f0c28f}\label{sgp4x_8c_a18dc072f9640fb68a76cedd0b4f0c28f} 
\#define {\bfseries SGP4\+X\+\_\+\+CMD\+\_\+\+SERIAL\+\_\+\+NUMBER}~UINT16\+\_\+C(0x3682)
\begin{DoxyCompactList}\small\item\em sgp4x I2C serial number request command \end{DoxyCompactList}\item 
\Hypertarget{sgp4x_8c_aafcb455fae4531a0f4fb064d297ce376}\label{sgp4x_8c_aafcb455fae4531a0f4fb064d297ce376} 
\#define {\bfseries SGP4\+X\+\_\+\+CMD\+\_\+\+EXEC\+\_\+\+CONDITIONING}~UINT16\+\_\+C(0x2612)
\begin{DoxyCompactList}\small\item\em sgp4x I2C \end{DoxyCompactList}\item 
\Hypertarget{sgp4x_8c_ae334971aa1dde59e09802d080c33c18d}\label{sgp4x_8c_ae334971aa1dde59e09802d080c33c18d} 
\#define {\bfseries SGP4\+X\+\_\+\+CMD\+\_\+\+MEAS\+\_\+\+RAW\+\_\+\+SIGNALS}~UINT16\+\_\+C(0x2619)
\begin{DoxyCompactList}\small\item\em sgp4x I2C \end{DoxyCompactList}\item 
\Hypertarget{sgp4x_8c_a6a8d982a8c99deec6f2fc73126612466}\label{sgp4x_8c_a6a8d982a8c99deec6f2fc73126612466} 
\#define {\bfseries SGP4\+X\+\_\+\+CMD\+\_\+\+EXEC\+\_\+\+SELF\+\_\+\+TEST}~UINT16\+\_\+C(0x280e)
\begin{DoxyCompactList}\small\item\em sgp4x I2C \end{DoxyCompactList}\item 
\Hypertarget{sgp4x_8c_a6d2e2a4f53c2ad0d687f3efc1d0826ab}\label{sgp4x_8c_a6d2e2a4f53c2ad0d687f3efc1d0826ab} 
\#define {\bfseries SGP4\+X\+\_\+\+CMD\+\_\+\+TURN\+\_\+\+HEATER\+\_\+\+OFF}~UINT16\+\_\+C(0x3615)
\begin{DoxyCompactList}\small\item\em sgp4x I2C \end{DoxyCompactList}\item 
\Hypertarget{sgp4x_8c_ae98302fbf5d96a3eefc1c579b4e54548}\label{sgp4x_8c_ae98302fbf5d96a3eefc1c579b4e54548} 
\#define {\bfseries SGP4\+X\+\_\+\+HUMIDITY\+\_\+\+COMP\+\_\+\+DEFAULT}~(float)(50.\+0)
\item 
\Hypertarget{sgp4x_8c_add16e2860663d0a4e6f9a7e9afea0648}\label{sgp4x_8c_add16e2860663d0a4e6f9a7e9afea0648} 
\#define {\bfseries SGP4\+X\+\_\+\+TEMPERATURE\+\_\+\+COMP\+\_\+\+DEFAULT}~(float)(25.\+0)
\item 
\Hypertarget{sgp4x_8c_ab9fe81afb93e4442e81f4159aae65cf2}\label{sgp4x_8c_ab9fe81afb93e4442e81f4159aae65cf2} 
\#define {\bfseries SGP4\+X\+\_\+\+TEMPERATURE\+\_\+\+MAX}~(float)(130.\+0)
\item 
\Hypertarget{sgp4x_8c_a26dcd2520e8c4b6dd9e5b0142b9c8b6a}\label{sgp4x_8c_a26dcd2520e8c4b6dd9e5b0142b9c8b6a} 
\#define {\bfseries SGP4\+X\+\_\+\+TEMPERATURE\+\_\+\+MIN}~(float)(-\/45.\+0)
\item 
\Hypertarget{sgp4x_8c_a054b0d37a7c3a6f636b673571203df49}\label{sgp4x_8c_a054b0d37a7c3a6f636b673571203df49} 
\#define {\bfseries SGP4\+X\+\_\+\+HUMIDITY\+\_\+\+MAX}~(float)(100.\+0)
\item 
\Hypertarget{sgp4x_8c_acafab2ec13f2fd526ababc8531d74acc}\label{sgp4x_8c_acafab2ec13f2fd526ababc8531d74acc} 
\#define {\bfseries SGP4\+X\+\_\+\+HUMIDITY\+\_\+\+MIN}~(float)(0.\+0)
\item 
\#define \mbox{\hyperlink{sgp4x_8c_ae2f1001caef83315b2751d0fe0def8aa}{SGP4\+X\+\_\+\+CONDITIONING\+\_\+\+TIMEOUT\+\_\+\+MS}}~UINT16\+\_\+C(1000)
\item 
\Hypertarget{sgp4x_8c_aaf5f4ff95ced48f1387a96316c6c1158}\label{sgp4x_8c_aaf5f4ff95ced48f1387a96316c6c1158} 
\#define {\bfseries SGP4\+X\+\_\+\+POWERUP\+\_\+\+DELAY\+\_\+\+MS}~UINT16\+\_\+C(10)
\item 
\#define \mbox{\hyperlink{sgp4x_8c_add529d5290434285094487f46697ac6a}{SGP4\+X\+\_\+\+APPSTART\+\_\+\+DELAY\+\_\+\+MS}}~UINT16\+\_\+C(10)
\item 
\#define \mbox{\hyperlink{sgp4x_8c_a8854136b0d6a520e0e3ed20c7fe8a8a2}{SGP4\+X\+\_\+\+CMD\+\_\+\+DELAY\+\_\+\+MS}}~UINT16\+\_\+C(5)
\item 
\Hypertarget{sgp4x_8c_a1f74cc86c30e1b52a77532df92174bb0}\label{sgp4x_8c_a1f74cc86c30e1b52a77532df92174bb0} 
\#define {\bfseries SGP4\+X\+\_\+\+RETRY\+\_\+\+DELAY\+\_\+\+MS}~UINT16\+\_\+C(2)
\item 
\#define \mbox{\hyperlink{sgp4x_8c_ac2bb3db0b37c9f45103fd513ca5158fe}{ESP\+\_\+\+ARG\+\_\+\+CHECK}}(VAL)
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
esp\+\_\+err\+\_\+t \mbox{\hyperlink{group__drivers_ga0bec60b8c1ab24e8061a1d6dadeed8fc}{sgp4x\+\_\+init}} (i2c\+\_\+master\+\_\+bus\+\_\+handle\+\_\+t master\+\_\+handle, const \mbox{\hyperlink{structsgp4x__config__t}{sgp4x\+\_\+config\+\_\+t}} \texorpdfstring{$\ast$}{*}sgp4x\+\_\+config, \mbox{\hyperlink{group__drivers_gac40d2deb3fe0027ff3588c50d583b0cd}{sgp4x\+\_\+handle\+\_\+t}} \texorpdfstring{$\ast$}{*}sgp4x\+\_\+handle)
\begin{DoxyCompactList}\small\item\em Initializes an SGP4X device onto the I2C master bus. \end{DoxyCompactList}\item 
esp\+\_\+err\+\_\+t \mbox{\hyperlink{group__drivers_ga52efe21453b1d3606b14e49aefef9ae1}{sgp4x\+\_\+execute\+\_\+compensated\+\_\+conditioning}} (\mbox{\hyperlink{group__drivers_gac40d2deb3fe0027ff3588c50d583b0cd}{sgp4x\+\_\+handle\+\_\+t}} handle, const float temperature, const float humidity, uint16\+\_\+t \texorpdfstring{$\ast$}{*}sraw\+\_\+voc)
\begin{DoxyCompactList}\small\item\em Starts the conditioning with temperature and humidity compensation, i.\+e., the VOC pixel will be operated at the same temperature as it is by calling the sgp41\+\_\+measure\+\_\+raw\+\_\+signals function while the NOx pixel will be operated at a different temperature for conditioning. The conditioning should be ran when the device is initially powered for 10-\/seconds but do not run the conditioning longer than 10-\/seconds, otherwise damage may occur to the SGP4X. \end{DoxyCompactList}\item 
esp\+\_\+err\+\_\+t \mbox{\hyperlink{group__drivers_ga12f002286cb3e1a07ee467160febf165}{sgp4x\+\_\+execute\+\_\+conditioning}} (\mbox{\hyperlink{group__drivers_gac40d2deb3fe0027ff3588c50d583b0cd}{sgp4x\+\_\+handle\+\_\+t}} handle, uint16\+\_\+t \texorpdfstring{$\ast$}{*}sraw\+\_\+voc)
\begin{DoxyCompactList}\small\item\em Starts the conditioning, i.\+e., the VOC pixel will be operated at the same temperature as it is by calling the sgp41\+\_\+measure\+\_\+raw\+\_\+signals function while the NOx pixel will be operated at a different temperature for conditioning. The conditioning should be ran when the device is initially powered for 10-\/seconds but do not run the conditioning longer than 10-\/seconds, otherwise damage may occur to the SGP4X. \end{DoxyCompactList}\item 
esp\+\_\+err\+\_\+t \mbox{\hyperlink{group__drivers_gaadd5bf985665147c4d997b26120dd9aa}{sgp4x\+\_\+measure\+\_\+compensated\+\_\+signals}} (\mbox{\hyperlink{group__drivers_gac40d2deb3fe0027ff3588c50d583b0cd}{sgp4x\+\_\+handle\+\_\+t}} handle, const float temperature, const float humidity, uint16\+\_\+t \texorpdfstring{$\ast$}{*}sraw\+\_\+voc, uint16\+\_\+t \texorpdfstring{$\ast$}{*}sraw\+\_\+nox)
\begin{DoxyCompactList}\small\item\em Starts and/or continues the VOC and NOX measurement mode with temperature and humidity compensation. \end{DoxyCompactList}\item 
esp\+\_\+err\+\_\+t \mbox{\hyperlink{group__drivers_ga4efe02574e8280c6d1f75e5d67c1c282}{sgp4x\+\_\+measure\+\_\+signals}} (\mbox{\hyperlink{group__drivers_gac40d2deb3fe0027ff3588c50d583b0cd}{sgp4x\+\_\+handle\+\_\+t}} handle, uint16\+\_\+t \texorpdfstring{$\ast$}{*}sraw\+\_\+voc, uint16\+\_\+t \texorpdfstring{$\ast$}{*}sraw\+\_\+nox)
\begin{DoxyCompactList}\small\item\em Starts and/or continues the VOC and NOX measurement mode using default temperature and humidity compensation. \end{DoxyCompactList}\item 
esp\+\_\+err\+\_\+t \mbox{\hyperlink{group__drivers_ga74a5a683b3490a8aaf03b03539929fae}{sgp4x\+\_\+execute\+\_\+self\+\_\+test}} (\mbox{\hyperlink{group__drivers_gac40d2deb3fe0027ff3588c50d583b0cd}{sgp4x\+\_\+handle\+\_\+t}} handle, sgp4x\+\_\+self\+\_\+test\+\_\+result\+\_\+t \texorpdfstring{$\ast$}{*}const result)
\begin{DoxyCompactList}\small\item\em Performs the built-\/in self-\/test that checks for integrity of both hotplate and MOX material. \end{DoxyCompactList}\item 
esp\+\_\+err\+\_\+t \mbox{\hyperlink{group__drivers_ga1a819671d1ed391a0666e7c8b3b0721e}{sgp4x\+\_\+turn\+\_\+heater\+\_\+off}} (\mbox{\hyperlink{group__drivers_gac40d2deb3fe0027ff3588c50d583b0cd}{sgp4x\+\_\+handle\+\_\+t}} handle)
\begin{DoxyCompactList}\small\item\em Turns the hotplate off, stops the measurement, and SGP4X enters idle mode. \end{DoxyCompactList}\item 
esp\+\_\+err\+\_\+t \mbox{\hyperlink{group__drivers_ga1dd9539587a9de55514ab1dbeeb5d705}{sgp4x\+\_\+reset}} (\mbox{\hyperlink{group__drivers_gac40d2deb3fe0027ff3588c50d583b0cd}{sgp4x\+\_\+handle\+\_\+t}} handle)
\begin{DoxyCompactList}\small\item\em Issues soft-\/reset and initializes SGP4X. See datasheet for details. \end{DoxyCompactList}\item 
esp\+\_\+err\+\_\+t \mbox{\hyperlink{group__drivers_ga05534062bf7f57eac9d0992fb788c4d7}{sgp4x\+\_\+remove}} (\mbox{\hyperlink{group__drivers_gac40d2deb3fe0027ff3588c50d583b0cd}{sgp4x\+\_\+handle\+\_\+t}} handle)
\begin{DoxyCompactList}\small\item\em Removes an SGP4X device from master bus. \end{DoxyCompactList}\item 
esp\+\_\+err\+\_\+t \mbox{\hyperlink{group__drivers_gad0cd93f1a86d46ac471b1266854ad781}{sgp4x\+\_\+delete}} (\mbox{\hyperlink{group__drivers_gac40d2deb3fe0027ff3588c50d583b0cd}{sgp4x\+\_\+handle\+\_\+t}} handle)
\begin{DoxyCompactList}\small\item\em Removes an SGP4X device from master bus and frees handle. \end{DoxyCompactList}\item 
const char \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{group__drivers_gaff4d0425f787cda12108abe40e286d37}{sgp4x\+\_\+get\+\_\+fw\+\_\+version}} (void)
\begin{DoxyCompactList}\small\item\em Converts SGP4X firmware version numbers (major, minor, patch) into a string. \end{DoxyCompactList}\item 
int32\+\_\+t \mbox{\hyperlink{group__drivers_ga2bf0031a0518fb0d4d8f1db8bf200dbb}{sgp4x\+\_\+get\+\_\+fw\+\_\+version\+\_\+number}} (void)
\begin{DoxyCompactList}\small\item\em Converts SGP4X firmware version numbers (major, minor, patch) into an integer value. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
ESP-\/\+IDF driver for SGP4X sensor

Ported from esp-\/open-\/rtos

Copyright (c) 2024 Eric Gionet (\href{mailto:gionet.c.eric@gmail.com}{\texttt{ gionet.\+c.\+eric@gmail.\+com}})

MIT Licensed as described in the file LICENSE 

\doxysubsection{Macro Definition Documentation}
\Hypertarget{sgp4x_8c_ac2bb3db0b37c9f45103fd513ca5158fe}\index{sgp4x.c@{sgp4x.c}!ESP\_ARG\_CHECK@{ESP\_ARG\_CHECK}}
\index{ESP\_ARG\_CHECK@{ESP\_ARG\_CHECK}!sgp4x.c@{sgp4x.c}}
\doxysubsubsection{\texorpdfstring{ESP\_ARG\_CHECK}{ESP\_ARG\_CHECK}}
{\footnotesize\ttfamily \label{sgp4x_8c_ac2bb3db0b37c9f45103fd513ca5158fe} 
\#define ESP\+\_\+\+ARG\+\_\+\+CHECK(\begin{DoxyParamCaption}\item[{}]{VAL}{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keywordflow}{do}\ \{\ \textcolor{keywordflow}{if}\ (!(VAL))\ \textcolor{keywordflow}{return}\ ESP\_ERR\_INVALID\_ARG;\ \}\ \textcolor{keywordflow}{while}\ (0)}

\end{DoxyCode}
\Hypertarget{sgp4x_8c_add529d5290434285094487f46697ac6a}\index{sgp4x.c@{sgp4x.c}!SGP4X\_APPSTART\_DELAY\_MS@{SGP4X\_APPSTART\_DELAY\_MS}}
\index{SGP4X\_APPSTART\_DELAY\_MS@{SGP4X\_APPSTART\_DELAY\_MS}!sgp4x.c@{sgp4x.c}}
\doxysubsubsection{\texorpdfstring{SGP4X\_APPSTART\_DELAY\_MS}{SGP4X\_APPSTART\_DELAY\_MS}}
{\footnotesize\ttfamily \label{sgp4x_8c_add529d5290434285094487f46697ac6a} 
\#define SGP4\+X\+\_\+\+APPSTART\+\_\+\+DELAY\+\_\+\+MS~UINT16\+\_\+C(10)}

delay after initialization before application start-\/up \Hypertarget{sgp4x_8c_a8854136b0d6a520e0e3ed20c7fe8a8a2}\index{sgp4x.c@{sgp4x.c}!SGP4X\_CMD\_DELAY\_MS@{SGP4X\_CMD\_DELAY\_MS}}
\index{SGP4X\_CMD\_DELAY\_MS@{SGP4X\_CMD\_DELAY\_MS}!sgp4x.c@{sgp4x.c}}
\doxysubsubsection{\texorpdfstring{SGP4X\_CMD\_DELAY\_MS}{SGP4X\_CMD\_DELAY\_MS}}
{\footnotesize\ttfamily \label{sgp4x_8c_a8854136b0d6a520e0e3ed20c7fe8a8a2} 
\#define SGP4\+X\+\_\+\+CMD\+\_\+\+DELAY\+\_\+\+MS~UINT16\+\_\+C(5)}

delay before attempting I2C transactions after a command is issued \Hypertarget{sgp4x_8c_ae2f1001caef83315b2751d0fe0def8aa}\index{sgp4x.c@{sgp4x.c}!SGP4X\_CONDITIONING\_TIMEOUT\_MS@{SGP4X\_CONDITIONING\_TIMEOUT\_MS}}
\index{SGP4X\_CONDITIONING\_TIMEOUT\_MS@{SGP4X\_CONDITIONING\_TIMEOUT\_MS}!sgp4x.c@{sgp4x.c}}
\doxysubsubsection{\texorpdfstring{SGP4X\_CONDITIONING\_TIMEOUT\_MS}{SGP4X\_CONDITIONING\_TIMEOUT\_MS}}
{\footnotesize\ttfamily \label{sgp4x_8c_ae2f1001caef83315b2751d0fe0def8aa} 
\#define SGP4\+X\+\_\+\+CONDITIONING\+\_\+\+TIMEOUT\+\_\+\+MS~UINT16\+\_\+C(1000)}

conditioning timeout 1-\/sec, 10-\/sec in total and maximum 