\doxysection{components/peripherals/owb/esp\+\_\+ds18b20 Directory Reference}
\hypertarget{dir_e7306013d7d0831bc5e5431cce9c1d12}{}\label{dir_e7306013d7d0831bc5e5431cce9c1d12}\index{components/peripherals/owb/esp\_ds18b20 Directory Reference@{components/peripherals/owb/esp\_ds18b20 Directory Reference}}
\doxysubsubsection*{Directories}
\begin{DoxyCompactItemize}
\item 
directory \mbox{\hyperlink{dir_5519b8894b353a00aa76daf52d5e4690}{include}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Files}
\begin{DoxyCompactItemize}
\item 
file \mbox{\hyperlink{ds18b20_8c}{ds18b20.\+c}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\href{https://github.com/K0I05}{\texttt{ }} \href{/LICENSE}{\texttt{ }} \href{https://en.wikipedia.org/wiki/C_(programming_language)}{\texttt{ }} \href{https://docs.espressif.com/projects/esp-idf/en/stable/esp32/index.html}{\texttt{ }} \href{https://code.visualstudio.com/}{\texttt{ }} \href{https://platformio.org/}{\texttt{ }} \href{https://registry.platformio.org/libraries/k0i05/esp_ds18b20}{\texttt{ }} \href{https://components.espressif.com/components/k0i05/esp_ds18b20}{\texttt{ }}

This ESP32 espressif IoT development framework (esp-\/idf) i2c peripheral driver was developed for the Maxim-\/\+Integrated DS18\+B20 1-\/wire temperature sensor. Information on features and functionality are documented and can be found in the {\ttfamily \doxylink{ds18b20_8h}{ds18b20.\+h}} header file and in the {\ttfamily documentation} folder.\hypertarget{README.md_autotoc_md96}{}\doxysubsection{\texorpdfstring{Repository}{Repository}}\label{README.md_autotoc_md96}
The component is hosted on github and is located here\+: \href{https://github.com/K0I05/ESP32-S3_ESP-IDF_COMPONENTS/tree/main/components/peripherals/owb/esp_ds18b20}{\texttt{ https\+://github.\+com/\+K0\+I05/\+ESP32-\/\+S3\+\_\+\+ESP-\/\+IDF\+\_\+\+COMPONENTS/tree/main/components/peripherals/owb/esp\+\_\+ds18b20}}\hypertarget{README.md_autotoc_md97}{}\doxysubsection{\texorpdfstring{General Usage}{General Usage}}\label{README.md_autotoc_md97}
To get started, simply copy the component to your project\textquotesingle{}s {\ttfamily components} folder and reference the {\ttfamily \doxylink{ds18b20_8h}{ds18b20.\+h}} header file as an include. The component includes documentation for the peripheral such as the datasheet, application notes, and/or user manual where applicable.


\begin{DoxyCode}{0}
\DoxyCodeLine{components}
\DoxyCodeLine{└──\ esp\_ds18b20}
\DoxyCodeLine{\ \ \ \ ├──\ CMakeLists.txt}
\DoxyCodeLine{\ \ \ \ ├──\ README.md}
\DoxyCodeLine{\ \ \ \ ├──\ LICENSE}
\DoxyCodeLine{\ \ \ \ ├──\ idf\_component.yml}
\DoxyCodeLine{\ \ \ \ ├──\ library.json}
\DoxyCodeLine{\ \ \ \ ├──\ documentation}
\DoxyCodeLine{\ \ \ \ │\ \ \ └──\ datasheets,\ etc.}
\DoxyCodeLine{\ \ \ \ ├──\ include}
\DoxyCodeLine{\ \ \ \ │\ \ \ └──\ ds18b20\_version.h}
\DoxyCodeLine{\ \ \ \ │\ \ \ └──\ ds18b20.h}
\DoxyCodeLine{\ \ \ \ └──\ ds18b20.c}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md98}{}\doxysubsection{\texorpdfstring{Basic Example}{Basic Example}}\label{README.md_autotoc_md98}
Once a driver instance is instantiated the sensor is ready for usage as shown in the below example. This basic implementation of the driver utilizes default configuration settings, prints DS18\+S20 sensors detected on the 1-\/wire bus, and makes a measurement request from the sensor at a user defined interval and prints the results.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{ds18b20_8h}{ds18b20.h}}>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ owb0\_ds18b20\_task(\ \textcolor{keywordtype}{void}\ *pvParameters\ )\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ initialize\ the\ xLastWakeTime\ variable\ with\ the\ current\ time.}}
\DoxyCodeLine{\ \ \ \ TickType\_t\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ last\_wake\_time\ =\ xTaskGetTickCount\ ();}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ initialize\ owb\ device\ configuration}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{group__drivers_gaf0a7fbdb7b61aa0636778a6f5e22ce68}{ds18b20\_config\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \ dev\_cfg\ =\ OWB\_DS18B20\_CONFIG\_DEFAULT;}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{group__drivers_gaa0631d921e9f741ba8c1cd3696723ba6}{ds18b20\_handle\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \ dev\_hdl;}
\DoxyCodeLine{\ \ \ \ onewire\_device\_iter\_handle\_t\ dev\_iter\_hdl;}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{structonewire__device__t}{onewire\_device\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \ dev;}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ owb\ ds18b20\ device\ detection}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{structonewire__device__t}{onewire\_device\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \ devs[5];}
\DoxyCodeLine{\ \ \ \ uint8\_t\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ devs\_size\ =\ \textcolor{keyword}{sizeof}(devs)\ /\ \textcolor{keyword}{sizeof}(devs[0]);}
\DoxyCodeLine{\ \ \ \ uint8\_t\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ devs\_count\ =\ 0;}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ detect\ ds18b20\ devices\ on\ 1-\/wire\ bus}}
\DoxyCodeLine{\ \ \ \ esp\_err\_t\ ret\ =\ \mbox{\hyperlink{group__drivers_ga92ed90eb99c6af8ced8ec60ded005e15}{ds18b20\_detect}}(owb0\_bus\_hdl,\ devs,\ devs\_size,\ \&devs\_count);}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}(ret\ ==\ ESP\_OK)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ ESP\_LOGW(APP\_TAG,\ \textcolor{stringliteral}{"{}ds18b20\ devices\ detected:\ \%u"{}},\ devs\_count);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(uint8\_t\ i\ =\ 0;\ i\ <\ devs\_count;\ i++)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}ds18b20(\%u),\ address:\ \%016llX"{}},\ i,\ devs[i].address);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ ESP\_LOGE(APP\_TAG,\ \textcolor{stringliteral}{"{}ds18b20\ device\ detect\ failed\ (\%s)"{}},\ esp\_err\_to\_name(ret));}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ instantiate\ 1-\/wire\ device\ iterator\ handle}}
\DoxyCodeLine{\ \ \ \ ESP\_ERROR\_CHECK(\ onewire\_new\_device\_iter(owb0\_bus\_hdl,\ \&dev\_iter\_hdl)\ );}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ get\ 1-\/wire\ device\ -\/\ assumes\ there\ is\ only\ one\ ds18b20\ device\ on\ the\ bus}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (onewire\_device\_iter\_get\_next(dev\_iter\_hdl,\ \&dev)\ ==\ ESP\_OK)\ \{\ \textcolor{comment}{//\ found\ a\ new\ device,\ let's\ check\ if\ we\ can\ upgrade\ it\ to\ a\ DS18B20}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ check\ if\ the\ device\ is\ a\ ds18b20,\ if\ so,\ return\ the\ ds18b20\ handle}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{group__drivers_ga873dc167ef31c19d2ed3c8aeb8858b40}{ds18b20\_init}}(\&dev,\ \&dev\_cfg,\ \&dev\_hdl)\ ==\ ESP\_OK)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}found\ a\ ds18b20,\ address:\ \%016llX"{}},\ dev.\mbox{\hyperlink{structonewire__device__t_a5afc4be76558fd465ffae808b95240db}{address}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}found\ an\ unknown\ device,\ address:\ \%016llX"{}},\ dev.\mbox{\hyperlink{structonewire__device__t_a5afc4be76558fd465ffae808b95240db}{address}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ assert(dev.\mbox{\hyperlink{structonewire__device__t_a5afc4be76558fd465ffae808b95240db}{address}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ free\ device\ iter\ handle}}
\DoxyCodeLine{\ \ \ \ ESP\_ERROR\_CHECK(\ onewire\_del\_device\_iter(dev\_iter\_hdl)\ );}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ get/set/get\ resolution}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{group__drivers_ga622b32418d99b0ae4feaf2e955f7a0f8}{ds18b20\_resolutions\_t}}\ dev\_reso;}
\DoxyCodeLine{\ \ \ \ ESP\_ERROR\_CHECK(\ \mbox{\hyperlink{group__drivers_ga7e59840ae488ec9c5d6f48449e3e9491}{ds18b20\_get\_resolution}}(dev\_hdl,\ \&dev\_reso)\ );}
\DoxyCodeLine{\ \ \ \ ESP\_LOGW(APP\_TAG,\ \textcolor{stringliteral}{"{}ds18b20\ get\ resolution:\ \%d"{}},\ dev\_reso);}
\DoxyCodeLine{\ \ \ \ ESP\_ERROR\_CHECK(\ \mbox{\hyperlink{group__drivers_ga3c7b35f59d1d0ef09399784a9bf4bb84}{ds18b20\_set\_resolution}}(dev\_hdl,\ \mbox{\hyperlink{group__drivers_ggacf07a98756a425197bfab93e4d170eaca0396bfa58a01fdd9922771715e1467f6}{DS18B20\_RESOLUTION\_11BIT}})\ );}
\DoxyCodeLine{\ \ \ \ ESP\_ERROR\_CHECK(\ \mbox{\hyperlink{group__drivers_ga7e59840ae488ec9c5d6f48449e3e9491}{ds18b20\_get\_resolution}}(dev\_hdl,\ \&dev\_reso)\ );}
\DoxyCodeLine{\ \ \ \ ESP\_LOGW(APP\_TAG,\ \textcolor{stringliteral}{"{}ds18b20\ get\ resolution:\ \%d"{}},\ dev\_reso);}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ validate\ device\ handle}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}(dev\_hdl\ ==\ NULL)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ ESP\_LOGE(APP\_TAG,\ \textcolor{stringliteral}{"{}ds18b20\ handle\ init\ failed"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ assert(dev\_hdl);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ task\ loop\ entry\ point}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}(\ ;;\ )\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\ DS18B20\ -\/\ START\ \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ handle\ sensor}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ temperature;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ esp\_err\_t\ result\ =\ \mbox{\hyperlink{group__drivers_gaf171cc3cd419edf22b67bd05e6840bb9}{ds18b20\_get\_measurement}}(dev\_hdl,\ \&temperature);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(result\ !=\ ESP\_OK)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGE(APP\_TAG,\ \textcolor{stringliteral}{"{}ds18b20\ device\ read\ failed\ (\%s)"{}},\ esp\_err\_to\_name(result));}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}temperature:\ \ \ \ \ \%.2f°C"{}},\ temperature);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\ DS18B20\ -\/\ END\ \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ pause\ the\ task\ per\ defined\ wait\ period}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ vTaskDelaySecUntil(\ \&last\_wake\_time,\ OWB0\_TASK\_SAMPLING\_RATE\ );}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ free\ resources}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{group__drivers_gacbd8f069919bd0e81dfc2d5376bdd35f}{ds18b20\_delete}}(\ dev\_hdl\ );}
\DoxyCodeLine{\ \ \ \ vTaskDelete(\ NULL\ );}
\DoxyCodeLine{\}}

\end{DoxyCode}


Copyright (c) 2024 Eric Gionet (\href{mailto:gionet.c.eric@gmail.com}{\texttt{ gionet.\+c.\+eric@gmail.\+com}}) 