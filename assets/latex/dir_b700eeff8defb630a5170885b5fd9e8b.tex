\doxysection{components/peripherals/i2c/esp\+\_\+bme680 Directory Reference}
\hypertarget{dir_b700eeff8defb630a5170885b5fd9e8b}{}\label{dir_b700eeff8defb630a5170885b5fd9e8b}\index{components/peripherals/i2c/esp\_bme680 Directory Reference@{components/peripherals/i2c/esp\_bme680 Directory Reference}}
\doxysubsubsection*{Directories}
\begin{DoxyCompactItemize}
\item 
directory \mbox{\hyperlink{dir_446033e2305cacd4f34bb63a971e1ed6}{include}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Files}
\begin{DoxyCompactItemize}
\item 
file \mbox{\hyperlink{bme680_8c}{bme680.\+c}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\href{https://github.com/K0I05}{\texttt{ }} \href{/LICENSE}{\texttt{ }} \href{https://en.wikipedia.org/wiki/C_(programming_language)}{\texttt{ }} \href{https://docs.espressif.com/projects/esp-idf/en/stable/esp32/index.html}{\texttt{ }} \href{https://code.visualstudio.com/}{\texttt{ }} \href{https://platformio.org/}{\texttt{ }} \href{https://registry.platformio.org/libraries/k0i05/esp_bme680}{\texttt{ }} \href{https://components.espressif.com/components/k0i05/esp_bme680}{\texttt{ }}

This ESP32 espressif IoT development framework (esp-\/idf) i2c peripheral driver was developed for the Bosch BME680 pressure, temperature, humidity and gas sensor. Information on features and functionality are documented and can be found in the {\ttfamily \doxylink{bme680_8h}{bme680.\+h}} header file and in the {\ttfamily documentation} folder.\hypertarget{README.md_autotoc_md26}{}\doxysubsection{\texorpdfstring{Repository}{Repository}}\label{README.md_autotoc_md26}
The component is hosted on github and is located here\+: \href{https://github.com/K0I05/ESP32-S3_ESP-IDF_COMPONENTS/tree/main/components/peripherals/i2c/esp_bme680}{\texttt{ https\+://github.\+com/\+K0\+I05/\+ESP32-\/\+S3\+\_\+\+ESP-\/\+IDF\+\_\+\+COMPONENTS/tree/main/components/peripherals/i2c/esp\+\_\+bme680}}\hypertarget{README.md_autotoc_md27}{}\doxysubsection{\texorpdfstring{General Usage}{General Usage}}\label{README.md_autotoc_md27}
To get started, simply copy the component to your project\textquotesingle{}s {\ttfamily components} folder and reference the {\ttfamily \doxylink{bme680_8h}{bme680.\+h}} header file as an include. The component includes documentation for the peripheral such as the datasheet, application notes, and/or user manual where applicable.


\begin{DoxyCode}{0}
\DoxyCodeLine{components}
\DoxyCodeLine{└──\ esp\_bme680}
\DoxyCodeLine{\ \ \ \ ├──\ CMakeLists.txt}
\DoxyCodeLine{\ \ \ \ ├──\ README.md}
\DoxyCodeLine{\ \ \ \ ├──\ LICENSE}
\DoxyCodeLine{\ \ \ \ ├──\ idf\_component.yml}
\DoxyCodeLine{\ \ \ \ ├──\ library.json}
\DoxyCodeLine{\ \ \ \ ├──\ documentation}
\DoxyCodeLine{\ \ \ \ │\ \ \ └──\ datasheets,\ etc.}
\DoxyCodeLine{\ \ \ \ ├──\ include}
\DoxyCodeLine{\ \ \ \ │\ \ \ └──\ bme680\_version.h}
\DoxyCodeLine{\ \ \ \ │\ \ \ └──\ bme680.h}
\DoxyCodeLine{\ \ \ \ └──\ bme680.c}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md28}{}\doxysubsection{\texorpdfstring{Basic Example}{Basic Example}}\label{README.md_autotoc_md28}
Once a driver instance is instantiated the sensor is ready for usage as shown in the below example. This basic implementation of the driver utilizes default configuration settings and makes a measurement request from the sensor at user defined interval and prints the results.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{bme680_8h}{bme680.h}}>}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ print\_registers(\mbox{\hyperlink{group__drivers_ga613796da4cb6da455381a179729e91f0}{bme680\_handle\_t}}\ handle)\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{/*\ configuration\ registers\ */}}
\DoxyCodeLine{\ \ \ \ bme680\_control\_measurement\_register\_t\ ctrl\_meas\_reg;}
\DoxyCodeLine{\ \ \ \ bme680\_control\_humidity\_register\_t\ \ \ \ ctrl\_humi\_reg;}
\DoxyCodeLine{\ \ \ \ bme680\_config\_register\_t\ \ \ \ \ \ \ \ \ \ \ \ \ \ config\_reg;}
\DoxyCodeLine{\ \ \ \ bme680\_control\_gas0\_register\_t\ \ \ \ \ \ \ \ ctrl\_gas0\_reg;}
\DoxyCodeLine{\ \ \ \ bme680\_control\_gas1\_register\_t\ \ \ \ \ \ \ \ ctrl\_gas1\_reg;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{/*\ attempt\ to\ read\ control\ humidity\ register\ */}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{group__drivers_gac9241adfbbf7d21531e5c997f704a348}{bme680\_get\_control\_humidity\_register}}(handle,\ \&ctrl\_humi\_reg);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{/*\ attempt\ to\ read\ control\ measurement\ register\ */}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{group__drivers_gabfbef4c619fd0ea64e7865014519e06e}{bme680\_get\_control\_measurement\_register}}(handle,\ \&ctrl\_meas\_reg);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{/*\ attempt\ to\ read\ configuration\ register\ */}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{group__drivers_ga5d99d3bd2ca005930e5b735e1d0049d2}{bme680\_get\_configuration\_register}}(handle,\ \&config\_reg);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{/*\ attempt\ to\ read\ control\ gas\ 0\ register\ */}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{group__drivers_gab445e7b178ff65ebd6a729c3df48f762}{bme680\_get\_control\_gas0\_register}}(handle,\ \&ctrl\_gas0\_reg);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{/*\ attempt\ to\ read\ control\ gas\ 1\ register\ */}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{group__drivers_ga4286bdbfb0299500c38524fb574727b9}{bme680\_get\_control\_gas1\_register}}(handle,\ \&ctrl\_gas1\_reg);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}Variant\ Id\ \ \ \ \ \ \ \ \ \ (0x\%02x):\ \%s"{}},\ handle-\/>variant\_id,\mbox{\hyperlink{group__utilities_gad5099995b3a7cf28d0daa6a503b98645}{uint8\_to\_binary}}(handle-\/>variant\_id));}
\DoxyCodeLine{\ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}Configuration\ \ \ \ \ \ \ (0x\%02x):\ \%s"{}},\ config\_reg.reg,\ \ \ \ \mbox{\hyperlink{group__utilities_gad5099995b3a7cf28d0daa6a503b98645}{uint8\_to\_binary}}(config\_reg.reg));}
\DoxyCodeLine{\ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}Control\ Measurement\ (0x\%02x):\ \%s"{}},\ ctrl\_meas\_reg.reg,\ \mbox{\hyperlink{group__utilities_gad5099995b3a7cf28d0daa6a503b98645}{uint8\_to\_binary}}(ctrl\_meas\_reg.reg));}
\DoxyCodeLine{\ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}Control\ Humidity\ \ \ \ (0x\%02x):\ \%s"{}},\ ctrl\_humi\_reg.reg,\ \mbox{\hyperlink{group__utilities_gad5099995b3a7cf28d0daa6a503b98645}{uint8\_to\_binary}}(ctrl\_humi\_reg.reg));}
\DoxyCodeLine{\ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}Control\ Gas\ 0\ \ \ \ \ \ \ (0x\%02x):\ \%s"{}},\ ctrl\_gas0\_reg.reg,\ \mbox{\hyperlink{group__utilities_gad5099995b3a7cf28d0daa6a503b98645}{uint8\_to\_binary}}(ctrl\_gas0\_reg.reg));}
\DoxyCodeLine{\ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}Control\ Gas\ 1\ \ \ \ \ \ \ (0x\%02x):\ \%s"{}},\ ctrl\_gas1\_reg.reg,\ \mbox{\hyperlink{group__utilities_gad5099995b3a7cf28d0daa6a503b98645}{uint8\_to\_binary}}(ctrl\_gas1\_reg.reg));}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ i2c0\_bme680\_task(\ \textcolor{keywordtype}{void}\ *pvParameters\ )\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ initialize\ the\ xLastWakeTime\ variable\ with\ the\ current\ time.}}
\DoxyCodeLine{\ \ \ \ TickType\_t\ \ \ \ \ \ \ \ \ \ last\_wake\_time\ \ =\ xTaskGetTickCount\ ();}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ initialize\ i2c\ device\ configuration}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{group__drivers_ga754b18e9f8c3f77d4c2738fa59403150}{bme680\_config\_t}}\ dev\_cfg\ \ \ \ \ \ \ \ \ =\ I2C\_BME680\_CONFIG\_DEFAULT;}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{group__drivers_ga613796da4cb6da455381a179729e91f0}{bme680\_handle\_t}}\ dev\_hdl;}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ init\ device}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{group__drivers_ga634c8a6901632299925de54d36aa85c4}{bme680\_init}}(i2c0\_bus\_hdl,\ \&dev\_cfg,\ \&dev\_hdl);}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (dev\_hdl\ ==\ NULL)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ ESP\_LOGE(APP\_TAG,\ \textcolor{stringliteral}{"{}bme680\ handle\ init\ failed"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ assert(dev\_hdl);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ print\_registers(dev\_hdl);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ task\ loop\ entry\ point}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (\ ;;\ )\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\ BME680\ -\/\ START\ \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ handle\ sensor}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \mbox{\hyperlink{group__drivers_ga3238b870a3bc18b1c513b52ebb74e125}{bme680\_data\_t}}\ data;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ esp\_err\_t\ result\ =\ bme680\_get\_measurements(dev\_hdl,\ \&data);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(result\ !=\ ESP\_OK)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGE(APP\_TAG,\ \textcolor{stringliteral}{"{}bme680\ device\ read\ failed\ (\%s)"{}},\ esp\_err\_to\_name(result));}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ data.\mbox{\hyperlink{structbme680__data__s_ad2a540b7fffffcd5581c3d05d94df7f6}{barometric\_pressure}}\ =\ data.\mbox{\hyperlink{structbme680__data__s_ad2a540b7fffffcd5581c3d05d94df7f6}{barometric\_pressure}}\ /\ 100;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}air\ temperature:\ \ \ \ \ \%.2f\ °C"{}},\ data.\mbox{\hyperlink{structbme680__data__s_a5cbb9c964da67812cd01b081c2fc6cd1}{air\_temperature}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}dewpoint\ temperature:\%.2f\ °C"{}},\ data.\mbox{\hyperlink{structbme680__data__s_a708b12e594d183ba115f10e8aca0665b}{dewpoint\_temperature}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}relative\ humidity:\ \ \ \%.2f\ \%\%"{}},\ data.\mbox{\hyperlink{structbme680__data__s_ad60830bc80efb7e8a11d6fb25518f55b}{relative\_humidity}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}barometric\ pressure:\ \%.2f\ hPa"{}},\ data.\mbox{\hyperlink{structbme680__data__s_ad2a540b7fffffcd5581c3d05d94df7f6}{barometric\_pressure}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}gas\ resistance:\ \ \ \ \ \ \%.2f\ kOhms"{}},\ data.\mbox{\hyperlink{structbme680__data__s_ac30cebc4cd86ec13a739515a74105b50}{gas\_resistance}}/1000);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}iaq\ score:\ \ \ \ \ \ \ \ \ \ \ \%u\ (\%s)"{}},\ data.\mbox{\hyperlink{structbme680__data__s_acebbf28041a5672d184c08d6dd285509}{iaq\_score}},\ bme680\_iaq\_air\_quality\_to\_string(data.\mbox{\hyperlink{structbme680__data__s_acebbf28041a5672d184c08d6dd285509}{iaq\_score}}));}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\ BME680\ -\/\ END\ \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ pause\ the\ task\ per\ defined\ wait\ period}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ vTaskDelaySecUntil(\ \&last\_wake\_time,\ I2C0\_TASK\_SAMPLING\_RATE\ );}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ free\ resources}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{group__drivers_ga43ca650aa6143976272296a64313fe69}{bme680\_delete}}(\ dev\_hdl\ );}
\DoxyCodeLine{\ \ \ \ vTaskDelete(\ NULL\ );}
\DoxyCodeLine{\}}

\end{DoxyCode}


Copyright (c) 2024 Eric Gionet (\href{mailto:gionet.c.eric@gmail.com}{\texttt{ gionet.\+c.\+eric@gmail.\+com}}) 