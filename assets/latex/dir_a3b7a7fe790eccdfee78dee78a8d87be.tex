\doxysection{components/schedule/esp\+\_\+time\+\_\+into\+\_\+interval Directory Reference}
\hypertarget{dir_a3b7a7fe790eccdfee78dee78a8d87be}{}\label{dir_a3b7a7fe790eccdfee78dee78a8d87be}\index{components/schedule/esp\_time\_into\_interval Directory Reference@{components/schedule/esp\_time\_into\_interval Directory Reference}}
\doxysubsubsection*{Directories}
\begin{DoxyCompactItemize}
\item 
directory \mbox{\hyperlink{dir_06a2ad4271a201b81c731b921f4517bb}{include}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Files}
\begin{DoxyCompactItemize}
\item 
file \mbox{\hyperlink{time__into__interval_8c}{time\+\_\+into\+\_\+interval.\+c}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\href{https://github.com/K0I05}{\texttt{ }} \href{/LICENSE}{\texttt{ }} \href{https://en.wikipedia.org/wiki/C_(programming_language)}{\texttt{ }} \href{https://docs.espressif.com/projects/esp-idf/en/stable/esp32/index.html}{\texttt{ }} \href{https://code.visualstudio.com/}{\texttt{ }} \href{https://platformio.org/}{\texttt{ }} \href{https://registry.platformio.org/libraries/k0i05/esp_time_into_interval}{\texttt{ }} \href{https://components.espressif.com/components/k0i05/esp_time_into_interval}{\texttt{ }}

The ESP time-\/into-\/interval component synchronizes a Free\+RTOS task with the system clock with user-\/defined time interval for temporal conditional scenarios.\hypertarget{README.md_autotoc_md110}{}\doxysubsection{\texorpdfstring{Repository}{Repository}}\label{README.md_autotoc_md110}
The component is hosted on github and is located here\+: \href{https://github.com/K0I05/ESP32-S3_ESP-IDF_COMPONENTS/tree/main/components/schedule/esp_time_into_interval}{\texttt{ https\+://github.\+com/\+K0\+I05/\+ESP32-\/\+S3\+\_\+\+ESP-\/\+IDF\+\_\+\+COMPONENTS/tree/main/components/schedule/esp\+\_\+time\+\_\+into\+\_\+interval}}\hypertarget{README.md_autotoc_md111}{}\doxysubsection{\texorpdfstring{General Usage}{General Usage}}\label{README.md_autotoc_md111}
To get started, simply copy the component to your project\textquotesingle{}s {\ttfamily components} folder and reference the {\ttfamily \doxylink{time__into__interval_8h}{time\+\_\+into\+\_\+interval.\+h}} header file as an include.


\begin{DoxyCode}{0}
\DoxyCodeLine{components}
\DoxyCodeLine{└──\ esp\_time\_into\_interval}
\DoxyCodeLine{\ \ \ \ ├──\ CMakeLists.txt}
\DoxyCodeLine{\ \ \ \ ├──\ README.md}
\DoxyCodeLine{\ \ \ \ ├──\ LICENSE}
\DoxyCodeLine{\ \ \ \ ├──\ idf\_component.yml}
\DoxyCodeLine{\ \ \ \ ├──\ library.json}
\DoxyCodeLine{\ \ \ \ ├──\ include}
\DoxyCodeLine{\ \ \ \ │\ \ \ └──\ time\_into\_interval\_version.h}
\DoxyCodeLine{\ \ \ \ │\ \ \ └──\ time\_into\_interval.h}
\DoxyCodeLine{\ \ \ \ └──\ time\_into\_interval.c}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md112}{}\doxysubsection{\texorpdfstring{Time-\/\+Into-\/\+Interval Example}{Time-\/\+Into-\/\+Interval Example}}\label{README.md_autotoc_md112}
See {\bfseries{Data-\/\+Table Example}}, declare a time-\/into-\/interval handle within the data-\/table sampling task sub-\/routine, and create a time-\/into-\/interval instance. The time-\/into-\/interval instance interval is every 5-\/minutes with 0-\/minutes into the interval.

The next step is declaring a conditional statement leveraging the {\ttfamily time\+\_\+into\+\_\+interval} function. This function returns true when the configured interval condition is valid, otherwise, it returns false. In this example, the time-\/into-\/interval function will output the data-\/table in json format every 5-\/minutes with a 10-\/second offset into the interval (i.\+e. 12\+:00\+:10, 12\+:05\+:10, 12\+:10\+:10, etc.).


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ dt\_1min\_smp\_task(\ \textcolor{keywordtype}{void}\ *pvParameters\ )\ \{}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{group___free_r_t_o_s_gaa862ccd8f6519ec10b85b169d3018023}{time\_into\_interval\_handle\_t}}\ dt\_1min\_tii\_5min\_hdl;}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{group___free_r_t_o_s_ga6e978e77c6c540b23118c566330e5c98}{time\_into\_interval\_config\_t}}\ dt\_1min\_tii\_5min\_cfg\ =\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .interval\_type\ \ \ \ \ \ =\ \mbox{\hyperlink{group___free_r_t_o_s_ggada504a9c0f0f4dfe0f199664315cf03eaebd695763de7ab8ba195c5714c94248b}{TIME\_INTO\_INTERVAL\_SEC}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .interval\_period\ \ \ \ =\ 5\ *\ 60,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .interval\_offset\ \ \ \ =\ 10}
\DoxyCodeLine{\ \ \ \ \};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ create\ a\ new\ time-\/into-\/interval\ handle\ -\/\ task\ system\ clock\ synchronization}}
\DoxyCodeLine{\ \ \ \ time\_into\_interval\_new(\&dt\_1min\_tii\_5min\_cfg,\ \&dt\_1min\_tii\_5min\_hdl);}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (dt\_1min\_tii\_5min\_hdl\ ==\ NULL)\ ESP\_LOGE(APP\_TAG,\ \textcolor{stringliteral}{"{}time\_into\_interval\_new,\ new\ time-\/into-\/interval\ handle\ failed"{}});\ }
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (\ ;;\ )\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{/*\ delay\ data-\/table\ sampling\ task\ until\ sampling\ interval\ has\ lapsed\ */}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \mbox{\hyperlink{group__drivers_gaf7216471d840ddce49979addde5497dd}{datatable\_sampling\_task\_delay}}(dt\_1min\_hdl);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{/*\ get\ measurement\ samples\ from\ sensors\ and\ set\ sensor\ variables\ (pa\ and\ ta)\ \ */}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ push\ samples\ onto\ the\ data\ buffer\ stack\ for\ processing}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \mbox{\hyperlink{group__drivers_ga8766983d0abc8827db4de6c427cac380}{datatable\_push\_float\_sample}}(dt\_1min\_hdl,\ dt\_1min\_pa\_avg\_col\_index,\ pa\_samples[samples\_index]);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \mbox{\hyperlink{group__drivers_ga8766983d0abc8827db4de6c427cac380}{datatable\_push\_float\_sample}}(dt\_1min\_hdl,\ dt\_1min\_ta\_avg\_col\_index,\ ta\_samples[samples\_index]);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \mbox{\hyperlink{group__drivers_ga8766983d0abc8827db4de6c427cac380}{datatable\_push\_float\_sample}}(dt\_1min\_hdl,\ dt\_1min\_ta\_min\_col\_index,\ ta\_samples[samples\_index]);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \mbox{\hyperlink{group__drivers_ga8766983d0abc8827db4de6c427cac380}{datatable\_push\_float\_sample}}(dt\_1min\_hdl,\ dt\_1min\_ta\_max\_col\_index,\ ta\_samples[samples\_index]);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \mbox{\hyperlink{group__drivers_ga8766983d0abc8827db4de6c427cac380}{datatable\_push\_float\_sample}}(dt\_1min\_hdl,\ dt\_1min\_td\_avg\_col\_index,\ td\_samples[samples\_index]);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ process\ data\ buffer\ stack\ samples\ (i.e.\ data-\/table's\ configured\ processing\ interval)}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \mbox{\hyperlink{group__drivers_ga7dbd90ddf9ee3cc22e0cccd995744c55}{datatable\_process\_samples}}(dt\_1min\_hdl);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{/*\ serialize\ data-\/table\ and\ output\ in\ json\ format\ every\ 5-\/minutes\ (i.e.\ 12:00:00,\ 12:05:00,\ 12:10:00,\ etc.)\ */}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{group___free_r_t_o_s_gad8797044bf62fb81d63b0641eb69d0d0}{time\_into\_interval}}(dt\_1min\_tii\_5min\_hdl))\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ create\ root\ object\ for\ data-\/table}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ cJSON\ *dt\_1min\_json\ =\ cJSON\_CreateObject();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ convert\ the\ data-\/table\ to\ json\ object}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{group__drivers_ga73545915b25d01821b94cf0a1a93a171}{datatable\_to\_json}}(dt\_1min\_hdl,\ \&dt\_1min\_json);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ render\ json\ data-\/table\ object\ to\ text\ and\ print}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ *dt\_1min\_json\_str\ =\ cJSON\_Print(dt\_1min\_json);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}JSON\ Data-\/Table:\(\backslash\)n\%s"{}},dt\_1min\_json\_str);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ free-\/up\ json\ resources}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ cJSON\_free(dt\_1min\_json\_str);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ cJSON\_Delete(dt\_1min\_json);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ free\ up\ task\ resources}}
\DoxyCodeLine{\ \ \ \ time\_into\_interval\_del(\ dt\_1min\_tii\_5min\_hdl\ );\ \textcolor{comment}{//delete\ time-\/into-\/interval\ handle}}
\DoxyCodeLine{\ \ \ \ vTaskDelete(\ NULL\ );}
\DoxyCodeLine{\}}

\end{DoxyCode}


You can declare as many time-\/into-\/interval handles as needed, or as memory permits, to sychronize real-\/time events with the system clock. See time-\/into-\/interval component and review documentation on features implemented to date.

Copyright (c) 2024 Eric Gionet (\href{mailto:gionet.c.eric@gmail.com}{\texttt{ gionet.\+c.\+eric@gmail.\+com}}) 