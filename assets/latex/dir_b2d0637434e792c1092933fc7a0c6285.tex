\doxysection{components/peripherals/i2c/esp\+\_\+as3935 Directory Reference}
\hypertarget{dir_b2d0637434e792c1092933fc7a0c6285}{}\label{dir_b2d0637434e792c1092933fc7a0c6285}\index{components/peripherals/i2c/esp\_as3935 Directory Reference@{components/peripherals/i2c/esp\_as3935 Directory Reference}}
\doxysubsubsection*{Directories}
\begin{DoxyCompactItemize}
\item 
directory \mbox{\hyperlink{dir_46f119730fbee89564e03edbf49bc5d7}{include}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Files}
\begin{DoxyCompactItemize}
\item 
file \mbox{\hyperlink{as3935_8c}{as3935.\+c}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\href{https://github.com/K0I05}{\texttt{ }} \href{/LICENSE}{\texttt{ }} \href{https://en.wikipedia.org/wiki/C_(programming_language)}{\texttt{ }} \href{https://docs.espressif.com/projects/esp-idf/en/stable/esp32/index.html}{\texttt{ }} \href{https://code.visualstudio.com/}{\texttt{ }} \href{https://platformio.org/}{\texttt{ }} \href{https://registry.platformio.org/libraries/k0i05/esp_as3935}{\texttt{ }} \href{https://components.espressif.com/components/k0i05/esp_as3935}{\texttt{ }}

This ESP32 espressif IoT development framework (esp-\/idf) i2c peripheral driver was developed for the Austria Microsystems AS3935 franklin lightning sensor. Information on features and functionality are documented and can be found in the {\ttfamily \doxylink{as3935_8h}{as3935.\+h}} header file and in the {\ttfamily documentation} folder.\hypertarget{README.md_autotoc_md14}{}\doxysubsection{\texorpdfstring{Repository}{Repository}}\label{README.md_autotoc_md14}
The component is hosted on github and is located here\+: \href{https://github.com/K0I05/ESP32-S3_ESP-IDF_COMPONENTS/tree/main/components/peripherals/i2c/esp_as3935}{\texttt{ https\+://github.\+com/\+K0\+I05/\+ESP32-\/\+S3\+\_\+\+ESP-\/\+IDF\+\_\+\+COMPONENTS/tree/main/components/peripherals/i2c/esp\+\_\+as3935}}\hypertarget{README.md_autotoc_md15}{}\doxysubsection{\texorpdfstring{General Usage}{General Usage}}\label{README.md_autotoc_md15}
To get started, simply copy the component to your project\textquotesingle{}s {\ttfamily components} folder and reference the {\ttfamily \doxylink{as3935_8h}{as3935.\+h}} header file as an include. The component includes documentation for the peripheral such as the datasheet, application notes, and/or user manual where applicable.


\begin{DoxyCode}{0}
\DoxyCodeLine{components}
\DoxyCodeLine{└──\ esp\_as3935}
\DoxyCodeLine{\ \ \ \ ├──\ CMakeLists.txt}
\DoxyCodeLine{\ \ \ \ ├──\ README.md}
\DoxyCodeLine{\ \ \ \ ├──\ LICENSE}
\DoxyCodeLine{\ \ \ \ ├──\ idf\_component.yml}
\DoxyCodeLine{\ \ \ \ ├──\ library.json}
\DoxyCodeLine{\ \ \ \ ├──\ documentation}
\DoxyCodeLine{\ \ \ \ │\ \ \ └──\ datasheets,\ etc.}
\DoxyCodeLine{\ \ \ \ ├──\ include}
\DoxyCodeLine{\ \ \ \ │\ \ \ └──\ as3935\_version.h}
\DoxyCodeLine{\ \ \ \ │\ \ \ └──\ as3935.h}
\DoxyCodeLine{\ \ \ \ └──\ as3935.c}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md16}{}\doxysubsection{\texorpdfstring{Basic Example}{Basic Example}}\label{README.md_autotoc_md16}
Once a driver instance is instantiated the sensor is ready for usage as shown in the below example. This basic implementation of the driver utilizes default configuration settings and monitors the interrupt on the AS3935. When an event is detected the AS3935 interrupt pin is asserted and event is printed to the serial terminal.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{as3935_8h}{as3935.h}}>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ as3935\_event\_handler(\textcolor{keywordtype}{void}\ *event\_handler\_arg,\ esp\_event\_base\_t\ event\_base,\ int32\_t\ event\_id,\ \textcolor{keywordtype}{void}\ *event\_data)\ \{}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{group__drivers_gad4067f669531ae9713b9e0a799029075}{as3935\_monitor\_context\_t}}\ *as3935\_monitor\_context\ =\ (\mbox{\hyperlink{group__drivers_gad4067f669531ae9713b9e0a799029075}{as3935\_monitor\_context\_t}}\ *)event\_data;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{switch}\ (event\_id)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{group__drivers_ggaf534bc5e125fdfbf1d17f73d9880b2f5a1ccbb566b6e1899730fd0617b6b27c94}{AS3935\_INT\_NOISE}}:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGW(APP\_TAG,\ \textcolor{stringliteral}{"{}as3935\ device\ interrupt\ was\ noise\ related"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{group__drivers_ggaf534bc5e125fdfbf1d17f73d9880b2f5a4cd264ad51e6e5cc0a3bab5cb76d3e39}{AS3935\_INT\_DISTURBER}}:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGW(APP\_TAG,\ \textcolor{stringliteral}{"{}as3935\ device\ interrupt\ was\ disturber\ related"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{group__drivers_ggaf534bc5e125fdfbf1d17f73d9880b2f5a6ec157f9e96f39eee8033d3dd08a393b}{AS3935\_INT\_LIGHTNING}}:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGW(APP\_TAG,\ \textcolor{stringliteral}{"{}as3935\ device\ interrupt\ was\ lightning\ related"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGW(APP\_TAG,\ \textcolor{stringliteral}{"{}Lightning\ distance:\ \%d"{}},\ as3935\_monitor\_context-\/>\mbox{\hyperlink{structas3935__monitor__context__s_aad53912c2782cf8087bf7408d6c9e701}{base}}.lightning\_distance);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{group__drivers_ggaf534bc5e125fdfbf1d17f73d9880b2f5a6075415d11590c339af65745e506458e}{AS3935\_INT\_NONE}}:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGW(APP\_TAG,\ \textcolor{stringliteral}{"{}as3935\ device\ interrupt\ was\ related\ to\ nothing"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ ESP\_LOGW(APP\_TAG,\ \textcolor{stringliteral}{"{}as3935\ device\ interrupt\ is\ unknown\ \%li"{}},\ event\_id);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ i2c0\_as3935\_task(\ \textcolor{keywordtype}{void}\ *pvParameters\ )\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ initialize\ the\ xLastWakeTime\ variable\ with\ the\ current\ time.}}
\DoxyCodeLine{\ \ \ \ TickType\_t\ \ \ \ \ \ \ \ \ last\_wake\_time\ \ \ =\ xTaskGetTickCount\ ();}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ initialize\ i2c\ device\ configuration}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{group__drivers_gae6862ac911069aff23cf8b3c4a847c4b}{as3935\_monitor\_handle\_t}}\ monitor\_hdl;}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{group__drivers_ga98b0fd83fb81dd7cbb6c853a260ac02a}{as3935\_config\_t}}\ dev\_cfg\ \ \ \ \ \ \ \ \ \ =\ \mbox{\hyperlink{group__drivers_ga5337283d5f009fbc64e6e464be6951c2}{I2C\_AS3935\_CONFIG\_DEFAULT}};}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//as3935\_handle\_t\ dev\_hdl;}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ init\ device}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//as3935\_init(i2c0\_bus\_hdl,\ \&dev\_cfg,\ \&dev\_hdl);}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{group__drivers_gafad46afc4709cc67901aef0e43fbedae}{as3935\_monitor\_init}}(i2c0\_bus\_hdl,\ \&dev\_cfg,\ \&monitor\_hdl);}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (monitor\_hdl\ ==\ NULL)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ ESP\_LOGE(APP\_TAG,\ \textcolor{stringliteral}{"{}as3935\_monitor\_init\ handle\ init\ failed"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ assert(\mbox{\hyperlink{group__drivers_gafad46afc4709cc67901aef0e43fbedae}{as3935\_monitor\_init}});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ esp\_err\_t\ err\ =\ \mbox{\hyperlink{group__drivers_ga8957dca4e77b125bbc1113cf08af2e81}{as3935\_monitor\_add\_handler}}(monitor\_hdl,\ as3935\_event\_handler,\ (\textcolor{keywordtype}{void}\ *)dev\_cfg.\mbox{\hyperlink{structas3935__config__s_aa6ec08546b6f7e00c2e1ee2e814b1375}{irq\_io\_num}});}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (err\ !=\ ESP\_OK)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ ESP\_LOGE(APP\_TAG,\ \textcolor{stringliteral}{"{}as3935\_monitor\_add\_handler\ failed"{}});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ task\ loop\ entry\ point}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (\ ;;\ )\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\ AS3935\ -\/\ START\ \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ handle\ sensor}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ ESP\_LOGI(APP\_TAG,\ \textcolor{stringliteral}{"{}\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\ AS3935\ -\/\ END\ \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#"{}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ pause\ the\ task\ per\ defined\ wait\ period}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ vTaskDelaySecUntil(\ \&last\_wake\_time,\ I2C0\_TASK\_SAMPLING\_RATE\ );}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ free\ resources}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//as3935\_delete(\ dev\_hdl\ );}}
\DoxyCodeLine{\ \ \ \ vTaskDelete(\ NULL\ );}
\DoxyCodeLine{\}}

\end{DoxyCode}


Copyright (c) 2024 Eric Gionet (\href{mailto:gionet.c.eric@gmail.com}{\texttt{ gionet.\+c.\+eric@gmail.\+com}}) 